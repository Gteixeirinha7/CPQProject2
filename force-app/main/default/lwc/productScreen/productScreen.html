<!-- sldsValidatorIgnore -->
<template>
	<template if:true={isOpenConfigKit}>
		<section
			role="dialog"
			tabindex="-1"
			aria-labelledby="modal-heading-01"
			aria-modal="true"
			aria-describedby="modal-content-id-1"
			class="slds-modal slds-fade-in-open container__kit-configure"
		>
			<lightning-spinner if:true={isLoadingModal} alternative-text="Loading..." size="medium"></lightning-spinner>

			<div class="slds-modal__container" style="width: 75% !important; max-width: 75% !important;">
				<header class="slds-modal__header">
					<button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={handleCloseConfigKit}>
						<lightning-icon
							icon-name="utility:close"
							alternative-text="close"
							variant="inverse"
							size="small">
						</lightning-icon>
						<span class="slds-assistive-text">Close</span>
					</button>

					<h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">Configurar Kit</h2>
				</header>

				<div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
					
					<lightning-layout multiple-rows horizontal-align="center">
						<lightning-layout-item class="slds-var-m-top_medium slds-var-p-horizontal_small" size="12" >
    						<lightning-progress-indicator current-step={currentGroupShowId}>
								<template for:each={currentProductConfig.groupAccessoryList} for:item="group" for:index="groupIndex">
    						    	<lightning-progress-step key={group.id} label={group.name} value={group.id}>
    						    	</lightning-progress-step>
								</template>
    						</lightning-progress-indicator>
						</lightning-layout-item>
						<lightning-layout-item class="slds-var-m-top_medium slds-var-p-horizontal_small" size="12"  style=" display: flex; justify-content: center;">
							<p><b>{currentGroupShowName}</b></p>
						</lightning-layout-item>
						<lightning-layout-item class="slds-var-m-top_medium slds-var-p-horizontal_small" size="3" >
								<div style="display: flex; flex-direction: row;">
    								<div class="container__header-title">
										<template for:each={currentProductConfig.groupAccessoryList} for:item="group" for:index="groupIndex">
											<template if:true={group.isListing}>
												<template for:each={group.accessoryList} for:item="accessory">
													<div key={accessory.id}>
														<template if:true={accessory.isSelected}>
															<c-selected-resource-component title={accessory.name} subs={accessory.prodCode}></c-selected-resource-component>
														</template>
													</div>
												</template>
											</template>
											<template if:false={group.isListing}>
												<template if:true={group.isNA}>
													<div key={group.id}>
														<c-selected-resource-component subs='ESTE ACESSÓRIO NÃO SE APLICA A MONTAGEM' title={group.nameCompleted}></c-selected-resource-component>
													</div>
												</template>
												<template if:true={group.isIncluded}>
													<div key={group.id}>
														<c-selected-resource-component subs='Incluso' title={group.nameCompleted}></c-selected-resource-component>
													</div>
												</template>
											</template>
										</template>
									</div>
								</div>

						</lightning-layout-item>
						<lightning-layout-item class="slds-var-m-top_medium slds-var-p-horizontal_small" size="9" >
							<lightning-layout multiple-rows horizontal-align="center">
								<template for:each={currentProductConfig.groupAccessoryList} for:item="group" for:index="groupIndex">
									<template if:true={group.isCurrentGroup}>
									<lightning-layout-item
										if:true={group.isShowGroup}
										key={group.id}
										class="slds-var-m-top_medium slds-var-p-horizontal_small"
										style="display: flex; flex-direction: column;"
										size="6"
									>
										<template if:true={group.isListing}>
										
											<div class="container__accessory-item">
												<template for:each={group.accessoryList} for:item="accessory">
												
													<div key={accessory.id}>
														<input
															data-id={accessory.id}
															data-group-id={accessory.groupId}
															type="checkbox"
															checked={accessory.isSelected}
															onclick={handlerSelectAccessory}
															disabled={group.isNotCurrentGroup}
														/>
														<label
															data-id={accessory.id}
															data-group-id={accessory.groupId}
															style="margin-left: 3px; cursor: pointer;"
															onclick={handlerSelectAccessory}
														>
															{accessory.prodCode} - {accessory.name} <b>(
																<lightning-formatted-number
																	value={accessory.price}
																	format-style="currency"
																	currency-code="BRL"
																	maximum-fraction-digits="2">
																</lightning-formatted-number>
															)</b>
														</label>
													</div>
												
												</template>
											
												<lightning-layout if:true={group.isCurrentGroup} class="slds-var-m-top_x-small" horizontal-align="spread">
													<lightning-button
														data-id={group.id}
														data-index={groupIndex}
														label="Voltar"
														onclick={onClickBackAccessoryGroup}
														disabled={group.isFirstGroup}
													>
													</lightning-button>
												
													<lightning-button
														data-id={group.id}
														data-index={groupIndex}
														label="Próximo"
														variant="brand"
														onclick={onClickNextAccessoryGroup}
														disabled={group.isLastGroup}
													>
													</lightning-button>
												</lightning-layout>
											</div>
										
										</template>
									
										<template if:false={group.isListing}>
											<div class="container__accessory-item">
												<p>
													<b>{group.nameCompleted}:</b>
												</p>
												<p if:true={group.isNA}> ESTE ACESSÓRIO NÃO SE APLICA A MONTAGEM </p>
												<p if:true={group.isIncluded}> Incluso </p>
											
												<lightning-layout if:true={group.isCurrentGroup} class="slds-var-m-top_x-small" horizontal-align="spread">
													<lightning-button
														data-id={group.id}
														data-index={groupIndex}
														label="Voltar"
														onclick={onClickBackAccessoryGroup}
														disabled={group.isFirstGroup}
													>
													</lightning-button>
												
													<lightning-button
														data-id={group.id}
														data-index={groupIndex}
														label="Próximo"
														variant="brand"
														onclick={onClickNextAccessoryGroup}
														disabled={group.isLastGroup}
													>
													</lightning-button>
												</lightning-layout>
											</div>
										</template>
									
									</lightning-layout-item>
									</template>
								</template>
							</lightning-layout>
						</lightning-layout-item>
					</lightning-layout>
				</div>

				<footer class="slds-modal__footer">
					<button class="slds-button slds-button_neutral" onclick={handleCloseConfigKit} title="Cancel">Cancel</button>
					<button class="slds-button slds-button_brand" onclick={handleSaveConfigKit} title="Salvar">Salvar</button>
				</footer>
			</div>
		</section>

		<div class="slds-backdrop slds-backdrop_open"></div>
	</template>

	<template if:true={isOpenNewAccessoryModal}>
		<section
			role="dialog"
			tabindex="-1"
			aria-labelledby="modal-heading-02"
			aria-modal="true"
			aria-describedby="modal-content-id-2"
			class="slds-modal slds-fade-in-open"
		>
			<lightning-spinner if:true={isLoadingModal} alternative-text="Loading..." size="medium"></lightning-spinner>

			<div class="slds-modal__container">
				<header class="slds-modal__header">
					<button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={onClickCancelNewAccessory}>
						<lightning-icon
							icon-name="utility:close"
							alternative-text="close"
							variant="inverse"
							size="small">
						</lightning-icon>
						<span class="slds-assistive-text">Close</span>
					</button>

					<h2 class="slds-text-heading_medium slds-hyphenate">Novo acessório</h2>
				</header>

				<div class="slds-modal__content slds-p-around_medium">
					<lightning-layout multiple-rows horizontal-align="center">
						<lightning-input
							name="productCode"
							label="Pesquisar acessório..."
							value={productCode}
							type="search"
							field-level-help="Digite o nome ou código do acessório"
							is-loading={productCodeLoading}
							onchange={handleProductCode}
						>
						</lightning-input>
					</lightning-layout>

					<lightning-layout multiple-rows horizontal-align="space">
						<template for:each={exceptionProducts} for:item="products">

							<lightning-layout-item
								key={products.id}
								class="slds-var-p-around_x-small"
								size="12" medium-device-size="12" large-device-size="12"
							>									
								
								<c-product-component-accessory
									product={products}
									onhandleproductdata={handleProductData}
									onclickselectexceptionaccessoryevent={clickSelectExceptionAccessoryEvent}
									onremoveexception={onClickRemoveExceptionAccessory}
								>
								</c-product-component-accessory>
							
							</lightning-layout-item>

						</template>
					</lightning-layout>
				</div>

				<footer class="slds-modal__footer">
					<button class="slds-button slds-button_neutral" title="Cancel" onclick={onClickCancelNewAccessory}>Cancelar</button>
					<button class="slds-button slds-button_brand" title="Salvar" onclick={onClickSaveNewAccessory}>Salvar</button>
				</footer>
			</div>
		</section>

		<div class="slds-backdrop slds-backdrop_open"></div>
	</template>

	<template if:true={isOpenEditAccessoryModal}>
		<section
			role="dialog"
			tabindex="-1"
			aria-labelledby="modal-heading-02"
			aria-modal="true"
			aria-describedby="modal-content-id-2"
			class="slds-modal slds-fade-in-open"
		>
			<lightning-spinner if:true={isLoadingModal} alternative-text="Loading..." size="medium"></lightning-spinner>

			<div class="slds-modal__container">
				<header class="slds-modal__header">
					<button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={onClickCancelNewAccessory}>
						<lightning-icon
							icon-name="utility:close"
							alternative-text="close"
							variant="inverse"
							size="small">
						</lightning-icon>
						<span class="slds-assistive-text">Close</span>
					</button>

					<h2 class="slds-text-heading_medium slds-hyphenate">Editar acessório</h2>
				</header>

				<div class="slds-modal__content slds-p-around_medium">
					<lightning-layout multiple-rows horizontal-align="space">
							<lightning-layout-item
								class="slds-var-p-around_x-small"
								size="12" medium-device-size="12" large-device-size="12"
							>								
								<c-product-component-accessory
									product={currentExceptionEdit}
									onhandleproductdata={handleAcessoryData}
									onclickselectexceptionaccessoryevent={clickSelectExceptionAccessoryEvent}
									onremoveexception={onClickRemoveExceptionAccessory}
								>
								</c-product-component-accessory>
							</lightning-layout-item>
					</lightning-layout>
				</div>

				<footer class="slds-modal__footer">
					<button class="slds-button slds-button_brand" title="Salvar" onclick={onClickCancelNewAccessory}>Fechar</button>
				</footer>
			</div>
		</section>

		<div class="slds-backdrop slds-backdrop_open"></div>
	</template>

	<div class="main">
		<lightning-spinner if:true={isLoading} alternative-text="Loading..." size="medium"></lightning-spinner>
		<lightning-layout class="container__header" horizontal-align="spread">
			<lightning-layout-item size="12">
			<div class="slds-page-header slds-page-header_record-home">
			  <div class="slds-page-header__row">
			    <div class="slds-page-header__col-title">
			      <div class="slds-media">
			        <div class="slds-media__figure">
			          <lightning-icon icon-name="standard:quotes"></lightning-icon>
			        </div>
			        <div class="slds-media__body">
			          <div class="slds-page-header__name">
			            <div class="slds-page-header__name-title">
			              <h1>
			                <span>Configurador de Produtos</span>
			                <span class="slds-page-header__title slds-truncate">{baseObject.Name}</span>
			              </h1>
			            </div>
			          </div>
			        </div>
			      </div>
			    </div>
			    <div class="slds-page-header__col-actions">
			      <div class="slds-page-header__controls">
			        <div class="slds-page-header__control">
			          <lightning-button-group>
			            <lightning-button label="Estrutura" onclick={handleNewStructure}   icon-name="utility:search" ></lightning-button>
			            <lightning-button label="Produto" onclick={handleSearchProductCode}  icon-name="utility:search" ></lightning-button>
			            <lightning-button label="Carrinho" onclick={handleCheckout} icon-name="utility:cart"></lightning-button>
			            <lightning-button if:false={isShowCheckout} label="Buscar" icon-name="utility:search" variant="brand" onclick={handleSearchProduct} disabled={isShowProducts}></lightning-button>
			            <lightning-button if:true={isShowCheckout}  label="Salvar" variant="brand" onclick={handleSaveProducts}></lightning-button>
			          </lightning-button-group>
			        </div>
			      </div>
			    </div>
			  </div>
			  <div class="slds-page-header__row slds-page-header__row_gutters">
			    <div class="slds-page-header__col-details">
			      <ul class="slds-page-header__detail-row">
			        <li class="slds-page-header__detail-block">
			          <div class="slds-text-title slds-truncate">Conta</div>
			          <div class="slds-truncate">{baseObject.Account.Name}</div>
			        </li>
			        <li class="slds-page-header__detail-block">
			          <div class="slds-text-title slds-truncate">Catalogo de Preço</div>
			          <div class="slds-truncate">{baseObject.Pricebook2.Name}</div>
			        </li>
			        <li class="slds-page-header__detail-block">
			          <div class="slds-text-title slds-truncate">Moeda</div>
			          <div class="slds-truncate">{baseObject.CurrencyIsoCode}</div>
			        </li>
			        <li class="slds-page-header__detail-block">
			          <div class="slds-text-title slds-truncate">Vendedor</div>
			          <div class="slds-truncate">{baseObject.CreatedBy.Name}</div>
			        </li>
			      </ul>
			    </div>
			  </div>
			</div>
			</lightning-layout-item>
		</lightning-layout>


	<lightning-layout if:true={isShowStructures} multiple-rows horizontal-align="space">
		<lightning-layout-item class="slds-var-p-horizontal_x-small container__items" size="12" medium-device-size="9" large-device-size="10">
    		<lightning-tabset variant="vertical">
    		    <lightning-tab label="Buscar Estrutura">
					<lightning-layout multiple-rows horizontal-align="space">
						<lightning-layout-item
							class="slds-var-m-vertical_xx-small slds-var-p-horizontal_x-small"
							size="12" style="text-align: center;font-size: 16px;font-weight: bold;"
						>
							<c-global-search-product-screen filter-list={filterList} onselectfilter={selectFilterComponent} onhandlefilter={handlefilterComponent}></c-global-search-product-screen>
						</lightning-layout-item>
						<lightning-layout-item
							class="slds-var-m-vertical_xx-small slds-var-p-horizontal_x-small"
							size="12" style="text-align: center;font-size: 16px;font-weight: bold;"
						>
							ESTRUTURAS DISPONIVEIS
						</lightning-layout-item>
						<template for:each={structures} for:item="structure">
							<lightning-layout-item key={structure.Id} class="slds-var-p-around_xx-small container__cart-structure" size="2" medium-device-size="2" small-device-size="4">
								<c-structure-component 
									structure={structure}
									onhandlestructure={handleStructure}>
								</c-structure-component>
							</lightning-layout-item>
						</template>	
						<lightning-layout-item class="slds-var-p-around_xx-small container__cart-structure" size="2" medium-device-size="2" small-device-size="4">
							<c-structure-component 
								structure={structureException}
								onhandlestructure={handleStructure}>
							</c-structure-component>
						</lightning-layout-item>
					</lightning-layout>
				</lightning-tab>
    		    <lightning-tab label="Estrutura Simplificada">
					<lightning-layout multiple-rows horizontal-align="space">
						<lightning-layout-item
							class="slds-var-m-vertical_xx-small slds-var-p-horizontal_x-small"
							size="12" style="text-align: center;font-size: 16px;font-weight: bold;"
						>
							<c-global-search-product-screen filter-list={filterListProducts} onselectfilter={selectFilterComponent} onhandlefilter={handlefilterComponent}></c-global-search-product-screen>
						</lightning-layout-item>
						<lightning-layout-item
							class="slds-var-m-vertical_xx-small slds-var-p-horizontal_x-small"
							size="12" style="text-align: center;font-size: 16px;font-weight: bold;"
						>
							PRODUTOS DISPONIVEIS
						</lightning-layout-item>
						<template for:each={products} for:item="structure">
							<lightning-layout-item key={structure.Id} class="slds-var-p-around_xx-small container__cart-structure" size="2" medium-device-size="2" small-device-size="4">
								<c-structure-component 
									structure={structure}
									onhandlestructure={handleStructure}>
								</c-structure-component>
							</lightning-layout-item>
						</template>	
					</lightning-layout>
				</lightning-tab>
			</lightning-tabset>
		</lightning-layout-item>
	</lightning-layout>

	<lightning-layout if:true={isShowResources} class="container__resource">
		<c-resource-component
			class="container__resource"
			resource-list={resourceList}
			selected-structure={selectedStructure}
			current-resource-activeted={currentResourceActiveted}
			activated-resource-index={activatedResourceIndex}
			onchooseresource={handleChooseResource}
			onchoosetyperesource={handleChooseTypeResource}
		>
		</c-resource-component>
	</lightning-layout>


		<lightning-layout if:true={isShowSearchProduct} multiple-rows horizontal-align="space">
			<lightning-layout-item class="slds-var-p-around_small" size="12">

				<lightning-layout horizontal-align="center">

					<lightning-layout-item size="6">
						<lightning-input
							name="productCode"
							label="Pesquisar produto..."
							value={productCode}
							type="search"
							field-level-help="Digite o nome ou código do produto"
							is-loading={productCodeLoading}
							onchange={handleProductCode}>
						</lightning-input>
					</lightning-layout-item>

				</lightning-layout>

			</lightning-layout-item>

			<template for:each={exceptionProducts} for:item="product">

				<lightning-layout-item
					key={product.id}
					class="slds-var-p-around_x-small"
					size="12" medium-device-size="5" large-device-size="5"
				>

					<c-product-component
						product={product}
						onhandleproductdata={handleProductData}
						onhandleconfigkit={handleConfigureKit}
						onhandleclearconfigkit={handleClearKitConfiguration}
						onhandleselectproduct={handleSelectProduct}
						onhandleremoveproduct={handleRemoveProduct}
						onhandlechangeacessory={handleChangeAcessory}
						onhandleremovecheckoutacessory={handleRemoveCheckoutAcessory}
						onhandleremoveexception={handleremoveexception}
						onhandleeditexception={handleeditexception}
						onaddexceptionaccessory={onClickAddExceptionAccessoryEvent}
					>
					</c-product-component>

				</lightning-layout-item>

			</template>

			<lightning-layout-item if:true={isShowSeeMoreButton} class="container__button-more" size="12">
				<lightning-button-icon
					icon-name="utility:down"
					size="medium"
					variant="brand"
					alternative-text="View More"
					onclick={onClickSeeMoreExceptionProduct}
				>
				</lightning-button-icon>
			</lightning-layout-item>
		</lightning-layout>


		<lightning-layout if:true={isShowProducts} class="container__product" multiple-rows horizontal-align="space" style=" display: flex; flex-direction: row; justify-content: flex-start;">
			<lightning-layout-item size="12" medium-device-size="4" large-device-size="4" style=" display: flex; flex-direction: row; justify-content: center; align-items: stretch;">
				<c-selected-structure-component 
					selected-structure={selectedStructure}
					selected-resource-list={selectedResourceList}>
				</c-selected-structure-component>
			</lightning-layout-item>
			<lightning-layout-item class="slds-var-p-around_x-small" size="12" medium-device-size="8" large-device-size="8">
				<template for:each={products} for:item="product">
					<lightning-layout key={product.id} class="container__product" multiple-rows horizontal-align="space">
						<lightning-layout-item class="slds-var-p-around_x-small" size="12" medium-device-size="12" large-device-size="12">
							<c-product-component
								product={product}
								onhandleproductdata={handleProductData}
								onhandleconfigkit={handleConfigureKit}
								onhandleclearconfigkit={handleClearKitConfiguration}
								onhandleselectproduct={handleSelectProduct}
								onhandleremoveproduct={handleRemoveProduct}
								onhandlechangeacessory={handleChangeAcessory}
								onhandleremovecheckoutacessory={handleRemoveCheckoutAcessory}
								onhandleremoveexception={handleremoveexception}
								onhandleeditexception={handleeditexception}
								onaddexceptionaccessory={onClickAddExceptionAccessoryEvent}
							>
							</c-product-component>
						</lightning-layout-item>
					</lightning-layout>

				</template>
			</lightning-layout-item>
		</lightning-layout>
		<lightning-layout if:true={isShowCheckout} multiple-rows  style="justify-content: center;">
			<template for:each={checkoutProducts} for:item="product">
				<lightning-layout-item key={product.id} class="slds-var-m-vertical_medium container__product-checkout" size="12" style="max-width: 85%;">
					<c-product-component
						product={product}
						onhandleproductdata={handleProductData}
						onhandleconfigkit={handleConfigureKit}
						onhandleclearconfigkit={handleClearKitConfiguration}
						onhandleselectproduct={handleSelectProduct}
						onhandleremoveproduct={handleRemoveProduct}
						onhandlechangeacessory={handleChangeAcessory}
						onhandleremovecheckoutacessory={handleRemoveCheckoutAcessory}
						onhandleremoveexception={handleremoveexception}
						onhandleeditexception={handleeditexception}
						onaddexceptionaccessory={onClickAddExceptionAccessoryEvent}
					>
					</c-product-component>
				</lightning-layout-item>
			</template>
		</lightning-layout>
	</div>
</template>